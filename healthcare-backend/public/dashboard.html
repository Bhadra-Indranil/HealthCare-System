<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Healthcare Management System</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2563eb;
        --primary-color-light: #dbeafe;
        --bg-color: #f3f4f6;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --border-radius: 0.5rem;
        --card-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      body {
        margin: 0;
        font-family: "Roboto", sans-serif;
        background: var(--bg-color);
        color: var(--text-primary);
      }

      .dashboard-container {
        display: grid;
        grid-template-columns: 250px 1fr;
        min-height: 100vh;
      }

      .sidebar {
        background: var(--primary-color);
        color: white;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
      }

      .sidebar-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .sidebar-header img {
        width: 40px;
        height: 40px;
      }

      .nav-menu {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .nav-item {
        margin-bottom: 0.5rem;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        color: white;
        text-decoration: none;
        border-radius: var(--border-radius);
        transition: background-color 0.3s;
      }

      .nav-link:hover,
      .nav-link.active {
        background: rgba(255, 255, 255, 0.1);
      }

      .nav-link i {
        width: 20px;
        text-align: center;
      }

      .main-content {
        padding: 2rem;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .dashboard-card {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .card-title {
        font-size: 1.1rem;
        font-weight: 500;
        color: var(--text-primary);
      }

      .card-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary-color-light);
        color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .card-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .card-label {
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .recent-activity {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
      }

      .activity-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .activity-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color);
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary-color-light);
        color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .activity-details {
        flex: 1;
      }

      .activity-title {
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
      }

      .activity-time {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .logout-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: background-color 0.3s;
        margin-top: auto;
      }

      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .role-specific {
        display: none;
      }

      .role-specific.active {
        display: block;
      }

      @media (max-width: 768px) {
        .dashboard-container {
          grid-template-columns: 1fr;
        }

        .sidebar {
          display: none;
        }
      }

      .analytics-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .analytics-section .dashboard-card {
        min-height: 300px;
      }

      canvas {
        width: 100% !important;
        height: 250px !important;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <img src="images/logo.svg" alt="Logo" width="40" height="40" />
          <h1>Healthcare</h1>
        </div>
        <nav>
          <ul class="nav-menu">
            <li class="nav-item">
              <a
                href="#dashboard"
                class="nav-link active"
                data-section="dashboard"
              >
                <i class="fas fa-home"></i>
                Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a href="#patients" class="nav-link" data-section="patients">
                <i class="fas fa-user-md"></i>
                Patients
              </a>
            </li>
            <li class="nav-item">
              <a
                href="#appointments"
                class="nav-link"
                data-section="appointments"
              >
                <i class="fas fa-calendar-alt"></i>
                Appointments
              </a>
            </li>
            <li class="nav-item">
              <a href="#records" class="nav-link" data-section="records">
                <i class="fas fa-file-medical"></i>
                Records
              </a>
            </li>
            <li class="nav-item">
              <a href="#analytics" class="nav-link" data-section="analytics">
                <i class="fas fa-chart-line"></i>
                Analytics
              </a>
            </li>
          </ul>
        </nav>
        <button id="logoutBtn" class="logout-btn">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </button>
      </aside>

      <main class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
          <div class="dashboard-header">
            <h1>Dashboard</h1>
            <div class="user-info">
              <div class="user-avatar">
                <span id="userInitials">JD</span>
              </div>
              <div>
                <div id="userName" class="user-name">John Doe</div>
                <div id="userRole" class="user-role">Doctor</div>
              </div>
            </div>
          </div>

          <!-- Doctor Dashboard -->
          <div id="doctorDashboard" class="role-specific">
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Today's Patients</h3>
                  <div class="card-icon">
                    <i class="fas fa-user-md"></i>
                  </div>
                </div>
                <div class="card-value">8</div>
                <div class="card-label">Patients scheduled for today</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Pending Reports</h3>
                  <div class="card-icon">
                    <i class="fas fa-file-medical"></i>
                  </div>
                </div>
                <div class="card-value">5</div>
                <div class="card-label">Reports awaiting review</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Specialization</h3>
                  <div class="card-icon">
                    <i class="fas fa-stethoscope"></i>
                  </div>
                </div>
                <div class="card-value" id="doctorSpecialization">
                  Cardiology
                </div>
                <div class="card-label">Your medical specialty</div>
              </div>
            </div>

            <div class="recent-activity">
              <h2>Recent Consultations</h2>
              <ul class="activity-list">
                <li class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-user-md"></i>
                  </div>
                  <div class="activity-details">
                    <div class="activity-title">
                      Patient Consultation - John Smith
                    </div>
                    <div class="activity-time">2 hours ago</div>
                  </div>
                </li>
                <li class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-file-medical-alt"></i>
                  </div>
                  <div class="activity-details">
                    <div class="activity-title">
                      Updated Medical Report - Sarah Johnson
                    </div>
                    <div class="activity-time">3 hours ago</div>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <!-- Nurse Dashboard -->
          <div id="nurseDashboard" class="role-specific">
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Patient Care</h3>
                  <div class="card-icon">
                    <i class="fas fa-procedures"></i>
                  </div>
                </div>
                <div class="card-value">12</div>
                <div class="card-label">Patients under care</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Medications</h3>
                  <div class="card-icon">
                    <i class="fas fa-pills"></i>
                  </div>
                </div>
                <div class="card-value">8</div>
                <div class="card-label">Pending medication rounds</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Vitals Check</h3>
                  <div class="card-icon">
                    <i class="fas fa-heartbeat"></i>
                  </div>
                </div>
                <div class="card-value">15</div>
                <div class="card-label">Vitals to be checked</div>
              </div>
            </div>

            <div class="recent-activity">
              <h2>Recent Care Activities</h2>
              <ul class="activity-list">
                <li class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-temperature-high"></i>
                  </div>
                  <div class="activity-details">
                    <div class="activity-title">Vitals Check - Room 302</div>
                    <div class="activity-time">1 hour ago</div>
                  </div>
                </li>
                <li class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-syringe"></i>
                  </div>
                  <div class="activity-details">
                    <div class="activity-title">
                      Medication Administered - Room 305
                    </div>
                    <div class="activity-time">2 hours ago</div>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <!-- Receptionist Dashboard -->
          <div id="receptionistDashboard" class="role-specific">
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Today's Appointments</h3>
                  <div class="card-icon">
                    <i class="fas fa-calendar-check"></i>
                  </div>
                </div>
                <div class="card-value">24</div>
                <div class="card-label">Scheduled appointments</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">New Registrations</h3>
                  <div class="card-icon">
                    <i class="fas fa-user-plus"></i>
                  </div>
                </div>
                <div class="card-value">5</div>
                <div class="card-label">New patients today</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Waiting Room</h3>
                  <div class="card-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                </div>
                <div class="card-value">8</div>
                <div class="card-label">Patients waiting</div>
              </div>
            </div>

            <!-- Analytics Section -->
            <div class="analytics-section">
              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Patient Demographics</h3>
                  <div class="card-icon">
                    <i class="fas fa-chart-pie"></i>
                  </div>
                </div>
                <canvas id="demographicsChart"></canvas>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Appointment Trends</h3>
                  <div class="card-icon">
                    <i class="fas fa-chart-line"></i>
                  </div>
                </div>
                <canvas id="appointmentTrendsChart"></canvas>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Department Distribution</h3>
                  <div class="card-icon">
                    <i class="fas fa-hospital"></i>
                  </div>
                </div>
                <canvas id="departmentChart"></canvas>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <h3 class="card-title">Age Distribution</h3>
                  <div class="card-icon">
                    <i class="fas fa-users"></i>
                  </div>
                </div>
                <canvas id="ageDistributionChart"></canvas>
              </div>
            </div>

            <div class="recent-activity">
              <h2>Recent Activities</h2>
              <ul class="activity-list">
                <li class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-user-plus"></i>
                  </div>
                  <div class="activity-details">
                    <div class="activity-title">
                      New Patient Registration - Michael Brown
                    </div>
                    <div class="activity-time">30 minutes ago</div>
                  </div>
                </li>
                <li class="activity-item">
                  <div class="activity-icon">
                    <i class="fas fa-calendar-plus"></i>
                  </div>
                  <div class="activity-details">
                    <div class="activity-title">
                      Appointment Scheduled - Dr. Smith
                    </div>
                    <div class="activity-time">1 hour ago</div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Patients Section -->
        <div id="patients" class="content-section">
          <div class="dashboard-header">
            <h1>Patients</h1>
            <button id="addPatientBtn" class="btn primary-btn">
              <i class="fas fa-plus"></i> Add New Patient
            </button>
          </div>

          <div class="patient-list">
            <h2>All Patients</h2>

            <!-- Search Input -->
            <div class="search-container">
              <input
                type="text"
                id="patientSearchInput"
                placeholder="Search by Patient ID or Name"
              />
            </div>

            <p id="noPatientsMessage" style="display: none">
              No patients found.
            </p>

            <!-- Patient Table -->
            <div class="table-responsive-container">
              <table>
                <thead>
                  <tr>
                    <th>Patient ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Date of Birth</th>
                    <th>Gender</th>
                    <th>Address</th>
                    <th>Medical Info</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="patientsTableBody">
                  <!-- Patient rows will be inserted here by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Appointments Section -->
        <div id="appointments" class="content-section">
          <div class="dashboard-header">
            <h1>Appointments</h1>
          </div>
          <!-- Appointments content will be loaded here -->
        </div>

        <!-- Add Patient Modal -->
        <div id="addPatientModal" class="modal">
          <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Add New Patient</h2>
            <form id="addPatientForm">
              <div class="form-group required">
                <label for="patientId"
                  >Patient ID <span class="required-asterisk">*</span></label
                >
                <input
                  type="text"
                  id="addPatientId"
                  name="patientId"
                  required
                />
              </div>
              <div class="form-group required">
                <label for="firstName"
                  >First Name <span class="required-asterisk">*</span></label
                >
                <input
                  type="text"
                  id="addPatientFirstName"
                  name="firstName"
                  required
                />
              </div>
              <div class="form-group required">
                <label for="lastName"
                  >Last Name <span class="required-asterisk">*</span></label
                >
                <input
                  type="text"
                  id="addPatientLastName"
                  name="lastName"
                  required
                />
              </div>
              <div class="form-group required">
                <label for="dateOfBirth"
                  >Date of Birth <span class="required-asterisk">*</span></label
                >
                <input
                  type="date"
                  id="addPatientDob"
                  name="dateOfBirth"
                  required
                />
              </div>
              <div class="form-group required">
                <label for="gender"
                  >Gender <span class="required-asterisk">*</span></label
                >
                <select id="addPatientGender" name="gender" required>
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="addPatientEmail" name="email" />
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" id="addPatientPhone" name="phone" />
              </div>
              <div class="form-group">
                <label for="address">Address</label>
                <input type="text" id="addPatientAddress" name="address" />
              </div>

              <!-- Appointment Details -->
              <div class="form-group">
                <label for="appointmentDate">Appointment Date</label>
                <input
                  type="date"
                  id="addPatientAppointmentDate"
                  name="appointmentDate"
                />
              </div>
              <div class="form-group">
                <label for="doctorId">Assign Doctor</label>
                <!-- Dropdown for selecting doctor -->
                <select id="addPatientDoctorId" name="doctorId">
                  <option value="">Select Doctor</option>
                  <!-- Options will be populated by JavaScript -->
                </select>
              </div>

              <button type="submit" class="btn primary-btn">Add Patient</button>
              <div
                id="addPatientMessage"
                class="message"
                style="display: none"
              ></div>
            </form>
          </div>
        </div>

        <!-- Add Medical History Modal -->
        <div id="addMedicalHistoryModal" class="modal">
          <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Add Medical History Entry</h2>
            <form id="addMedicalHistoryForm">
              <input
                type="hidden"
                id="medicalHistoryPatientId"
                name="patientId"
              />
              <div class="form-group required">
                <label for="condition"
                  >Condition <span class="required-asterisk">*</span></label
                >
                <input type="text" id="condition" name="condition" required />
              </div>
              <div class="form-group required">
                <label for="diagnosisDate"
                  >Diagnosis Date
                  <span class="required-asterisk">*</span></label
                >
                <input
                  type="date"
                  id="diagnosisDate"
                  name="diagnosisDate"
                  required
                />
              </div>
              <div class="form-group required">
                <label for="historyStatus"
                  >Status <span class="required-asterisk">*</span></label
                >
                <select id="historyStatus" name="status" required>
                  <option value="">Select Status</option>
                  <option value="Active">Active</option>
                  <option value="Resolved">Resolved</option>
                  <option value="Chronic">Chronic</option>
                  <option value="Under Observation">Under Observation</option>
                </select>
              </div>
              <div class="form-group required">
                <label for="historySeverity"
                  >Severity <span class="required-asterisk">*</span></label
                >
                <select id="historySeverity" name="severity" required>
                  <option value="">Select Severity</option>
                  <option value="Mild">Mild</option>
                  <option value="Moderate">Moderate</option>
                  <option value="Severe">Severe</option>
                  <option value="Critical">Critical</option>
                </select>
              </div>
              <div class="form-group">
                <label for="historyNotes">Notes</label>
                <textarea id="historyNotes" name="notes"></textarea>
              </div>
              <button type="submit" class="btn primary-btn">
                Save Medical History
              </button>
              <div
                id="addMedicalHistoryMessage"
                class="message"
                style="display: none"
              ></div>
            </form>
          </div>
        </div>

        <!-- Add Allergy Modal -->
        <div id="addAllergyModal" class="modal">
          <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Add Allergy</h2>
            <form id="addAllergyForm">
              <input type="hidden" id="allergyPatientId" name="patientId" />
              <div class="form-group required">
                <label for="allergen"
                  >Allergen <span class="required-asterisk">*</span></label
                >
                <input type="text" id="allergen" name="allergen" required />
              </div>
              <div class="form-group required">
                <label for="allergySeverity"
                  >Severity <span class="required-asterisk">*</span></label
                >
                <select id="allergySeverity" name="severity" required>
                  <option value="">Select Severity</option>
                  <option value="Mild">Mild</option>
                  <option value="Moderate">Moderate</option>
                  <option value="Severe">Severe</option>
                  <option value="Life-threatening">Life-threatening</option>
                </select>
              </div>
              <div class="form-group">
                <label for="reaction">Reaction</label>
                <textarea id="reaction" name="reaction"></textarea>
              </div>
              <div class="form-group">
                <label for="allergyNotes">Notes</label>
                <textarea id="allergyNotes" name="notes"></textarea>
              </div>
              <div class="form-group">
                <label for="diagnosedDate">Diagnosed Date</label>
                <input type="date" id="diagnosedDate" name="diagnosedDate" />
              </div>
              <button type="submit" class="btn primary-btn">
                Save Allergy
              </button>
              <div
                id="addAllergyMessage"
                class="message"
                style="display: none"
              ></div>
            </form>
          </div>
        </div>

        <!-- Add Prescription Modal -->
        <div id="addPrescriptionModal" class="modal">
          <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Add Prescription</h2>
            <form id="addPrescriptionForm">
              <input
                type="hidden"
                id="prescriptionPatientId"
                name="patientId"
              />
              <div class="form-group required">
                <label for="medication"
                  >Medication <span class="required-asterisk">*</span></label
                >
                <input type="text" id="medication" name="medication" required />
              </div>
              <div class="form-group required">
                <label for="dosage"
                  >Dosage <span class="required-asterisk">*</span></label
                >
                <input type="text" id="dosage" name="dosage" required />
              </div>
              <div class="form-group required">
                <label for="frequency"
                  >Frequency <span class="required-asterisk">*</span></label
                >
                <input type="text" id="frequency" name="frequency" required />
              </div>
              <div class="form-group required">
                <label for="startDate"
                  >Start Date <span class="required-asterisk">*</span></label
                >
                <input type="date" id="startDate" name="startDate" required />
              </div>
              <div class="form-group">
                <label for="endDate">End Date</label>
                <input type="date" id="endDate" name="endDate" />
              </div>
              <div class="form-group">
                <label for="prescriptionNotes">Notes</label>
                <textarea id="prescriptionNotes" name="notes"></textarea>
              </div>
              <button type="submit" class="btn primary-btn">
                Save Prescription
              </button>
              <div
                id="addPrescriptionMessage"
                class="message"
                style="display: none"
              ></div>
            </form>
          </div>
        </div>

        <!-- Add Lab Report Modal -->
        <div id="addLabReportModal" class="modal">
          <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Add Lab Report</h2>
            <form id="addLabReportForm">
              <input type="hidden" id="labReportPatientId" name="patientId" />
              <div class="form-group required">
                <label for="testName"
                  >Test Name <span class="required-asterisk">*</span></label
                >
                <input type="text" id="testName" name="testName" required />
              </div>
              <div class="form-group required">
                <label for="labReportDate"
                  >Date <span class="required-asterisk">*</span></label
                >
                <input type="date" id="labReportDate" name="date" required />
              </div>
              <div class="form-group">
                <label for="results">Results</label>
                <textarea id="results" name="results"></textarea>
              </div>
              <div class="form-group required">
                <label for="labReportStatus"
                  >Status <span class="required-asterisk">*</span></label
                >
                <select id="labReportStatus" name="status" required>
                  <option value="">Select Status</option>
                  <option value="Pending">Pending</option>
                  <option value="Completed">Completed</option>
                  <option value="Abnormal">Abnormal</option>
                  <option value="Critical">Critical</option>
                </select>
              </div>
              <div class="form-group">
                <label for="labReportNotes">Notes</label>
                <textarea id="labReportNotes" name="notes"></textarea>
              </div>
              <button type="submit" class="btn primary-btn">
                Save Lab Report
              </button>
              <div
                id="addLabReportMessage"
                class="message"
                style="display: none"
              ></div>
            </form>
          </div>
        </div>
      </main>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/patients.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const user = JSON.parse(localStorage.getItem("user"));
        if (user) {
          // Update user info
          document.getElementById("userName").textContent = user.name;
          document.getElementById("userRole").textContent =
            user.role.charAt(0).toUpperCase() + user.role.slice(1);
          document.getElementById("userInitials").textContent = user.name
            .split(" ")
            .map((n) => n[0])
            .join("");

          // Show role-specific dashboard
          const roleDashboards = {
            doctor: document.getElementById("doctorDashboard"),
            nurse: document.getElementById("nurseDashboard"),
            receptionist: document.getElementById("receptionistDashboard"),
          };

          // Hide all dashboards first
          Object.values(roleDashboards).forEach((dashboard) => {
            if (dashboard) dashboard.classList.remove("active");
          });

          // Show the appropriate dashboard
          const userDashboard = roleDashboards[user.role.toLowerCase()];
          if (userDashboard) {
            userDashboard.classList.add("active");
          }

          // Update role-specific information
          if (user.role.toLowerCase() === "doctor" && user.specialization) {
            document.getElementById("doctorSpecialization").textContent =
              user.specialization;
          }
        }

        // Get modal and button elements
        const addPatientModal = document.getElementById("addPatientModal");
        const addPatientBtn = document.getElementById("addPatientBtn");
        const closeButton = addPatientModal
          ? addPatientModal.querySelector(".close-button")
          : null;
        const addPatientForm = document.getElementById("addPatientForm");
        const addPatientMessage = document.getElementById("addPatientMessage");
        const patientsTableBody = document.getElementById("patientsTableBody");
        const noPatientsMessage = document.getElementById("noPatientsMessage");

        // Function to open the modal
        if (addPatientBtn && addPatientModal) {
          addPatientBtn.onclick = function () {
            addPatientModal.style.display = "block";
            if (addPatientMessage) addPatientMessage.style.display = "none"; // Hide previous messages
            if (addPatientForm) addPatientForm.reset(); // Clear the form
          };
        }

        // Function to close the modal
        if (closeButton && addPatientModal) {
          closeButton.onclick = function () {
            addPatientModal.style.display = "none";
          };
        }

        // Close the modal if the user clicks outside of it
        window.onclick = function (event) {
          if (addPatientModal && event.target == addPatientModal) {
            addPatientModal.style.display = "none";
          }
        };

        // Load patients when the patients tab is activated
        const patientsNavLink = document.querySelector(
          '.nav-link[data-section="patients"]'
        );
        if (patientsNavLink) {
          patientsNavLink.addEventListener("click", () => {
            // Delay fetchPatients slightly to ensure section is visible
            setTimeout(window.fetchPatients, 50);
          });
        }

        // Show initial section logic (existing code, ensure it triggers fetchPatients if starting on patients tab)
        const initialSectionId =
          window.location.hash.substring(1) || "dashboard";
        const initialNavLink = document.querySelector(
          `.nav-link[data-section="${initialSectionId}"]`
        );
        if (initialNavLink) {
          initialNavLink.click(); // Simulate click to show the correct initial section and load data
        }

        // Function to fetch and update analytics data (moved inside DOMContentLoaded)
        async function updateAnalytics() {
          try {
            const response = await fetch("/api/v1/analytics", {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("token")}`,
              },
            });
            const data = await response.json();

            // Check if canvas elements exist before creating charts
            if (document.getElementById("demographicsChart")) {
              new Chart(document.getElementById("demographicsChart"), {
                type: "pie",
                data: {
                  labels: ["Male", "Female", "Other"],
                  datasets: [
                    {
                      data: [
                        data.demographics.gender.male || 0,
                        data.demographics.gender.female || 0,
                        data.demographics.gender.other || 0,
                      ],
                      backgroundColor: ["#3B82F6", "#EC4899", "#10B981"],
                    },
                  ],
                },
                options: {
                  responsive: true,
                  plugins: {
                    legend: {
                      position: "bottom",
                    },
                  },
                },
              });
            }

            // Appointment Trends Chart
            new Chart(document.getElementById("appointmentTrendsChart"), {
              type: "line",
              data: {
                labels: data.appointments.labels,
                datasets: [
                  {
                    label: "Daily Appointments",
                    data: data.appointments.data,
                    borderColor: "#3B82F6",
                    tension: 0.4,
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "bottom",
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                  },
                },
              },
            });

            // Department Distribution Chart
            new Chart(document.getElementById("departmentChart"), {
              type: "bar",
              data: {
                labels: data.departments.labels,
                datasets: [
                  {
                    label: "Patient Distribution",
                    data: data.departments.data,
                    backgroundColor: "#3B82F6",
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "bottom",
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                  },
                },
              },
            });

            // Age Distribution Chart
            new Chart(document.getElementById("ageDistributionChart"), {
              type: "bar",
              data: {
                labels: data.ageDistribution.labels,
                datasets: [
                  {
                    label: "Age Groups",
                    data: data.ageDistribution.data,
                    backgroundColor: "#10B981",
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "bottom",
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                  },
                },
              },
            });
          } catch (error) {
            console.error("Error fetching analytics:", error);
          }
        }

        // Update analytics when dashboard loads
        if (user && user.role.toLowerCase() === "receptionist") {
          updateAnalytics();
        }
      });
    </script>
  </body>
</html>
